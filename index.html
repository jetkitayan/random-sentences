<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Random English Sentences</title>
<style>
body {
  font-family: sans-serif;
  margin: 0;
  padding: 0 0 160px 0;
  background-color: #fafafa;
}
#content {
  margin-top: 20px;
  padding-left: 40px;
  max-width: 900px;
}
.count-label,
#sentence-jp,
#sentence-en {
  margin: 50px 0;
  line-height: 1.6;
  font-size: 48px;
  color: #000;
}
#button-area {
  position: fixed;
  bottom: 30px; /* â† ä¸‹ç«¯ã‹ã‚‰30pxä¸Šã«é…ç½® */
  left: 0;
  width: 100%;
  background: #fff;
  border-top: 1px solid #ddd;
  padding: 30px 0; /* â† é«˜ã•ã«ä½™è£•ã‚’æŒãŸã›ã‚‹ */
  box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
  text-align: center;
}

#button-area {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 160px; /* é«˜ã•ã‚’å›ºå®šã—ã¦ä¸­å¤®å¯„ã›ã—ã‚„ã™ãã™ã‚‹ */
  background: #fff;
  border-top: 1px solid #ddd;
  box-shadow: 0 -2px 6px rgba(0,0,0,0.1);

  /* â˜… flexã§ä¸Šä¸‹å·¦å³ä¸­å¤®é…ç½® */
  display: flex;
  justify-content: center; /* å·¦å³ä¸­å¤® */
  align-items: center;     /* ä¸Šä¸‹ä¸­å¤® */
  gap: 20px; /* ãƒœã‚¿ãƒ³ã®é–“éš” */
}

button {
  padding: 30px 60px;
  font-size: 26px;
  border-radius: 12px;
  cursor: pointer;
}

#statsArea {
  display: none;
  padding: 20px 40px;
}
#statsArea table {
  border-collapse: collapse;
  width: 100%;
}
#statsArea th, #statsArea td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}

/* âœ… è¿½åŠ éƒ¨åˆ† */
.top-meta {
  margin-bottom: 50px;
}
</style>
</head>
<body>

<div id="content">
  <div id="sentence-jp">Press "Show Random" to start</div>
  <div id="sentence-en"></div>
</div>

<div id="button-area">
  <button id="showBtn">Show Random</button>
  <button id="okBtn" disabled>OK (YES)</button>
  <button id="resetBtn">Reset</button>
  <button id="statsBtn">Show Stats</button>
  <button id="copyBtn">Copy Stats</button>
</div>

<!-- âœ… ä¸€è¦§è¡¨ç¤ºé ˜åŸŸ -->
<div id="statsArea">
  <h3>ğŸ“Š è¡¨ç¤ºå±¥æ­´ä¸€è¦§</h3>
  <table>
    <thead>
      <tr>
        <th>æ—¥æœ¬èª</th>
        <th>è‹±èª</th>
        <th>YESæŠ¼ä¸‹</th>
        <th>è¡¨ç¤ºå›æ•°</th>
      </tr>
    </thead>
    <tbody id="statsBody"></tbody>
  </table>
</div>

<script>
let allSentences = [];
let shownCounts = JSON.parse(localStorage.getItem("shownCounts")) || {};
let yesMarks = JSON.parse(localStorage.getItem("yesMarks")) || {}; // âœ… YESæŠ¼ä¸‹å±¥æ­´ã‚’ä¿æŒ
let remaining = JSON.parse(localStorage.getItem("remaining")) || [];
let currentSentence = null;

fetch("sentences.json")
  .then(response => response.json())
  .then(data => {
    allSentences = data;
    if (remaining.length === 0) remaining = allSentences.map(s => s.en);
  });

function showRandom() {
  if (remaining.length === 0) {
    document.getElementById("sentence-jp").innerText = "ã™ã¹ã¦ã®è‹±æ–‡ã‚’è¡¨ç¤ºã—ã¾ã—ãŸï¼";
    document.getElementById("sentence-en").innerText = "";
    document.getElementById("showBtn").disabled = true;
    document.getElementById("okBtn").disabled = true;
    return;
  }

  const en = remaining[Math.floor(Math.random() * remaining.length)];
  currentSentence = allSentences.find(s => s.en === en);

  if (!shownCounts[en]) shownCounts[en] = 0;
  shownCounts[en]++;
  localStorage.setItem("shownCounts", JSON.stringify(shownCounts));

  const totalShown = Object.values(shownCounts).reduce((a,b)=>a+b,0);

  document.getElementById("sentence-jp").innerHTML = `
    <div class="top-meta">${shownCounts[en]}å›ç›® ï¼ˆç·å›æ•°: ${totalShown}ï¼‰</div>
    <div>${currentSentence.jp}</div>
  `;
  document.getElementById("sentence-en").innerText = currentSentence.en;
  document.getElementById("okBtn").disabled = false;
}

function confirmSentence() {
  if (!currentSentence) return;

  // âœ… YESæŠ¼ä¸‹ã‚’è¨˜éŒ²
  yesMarks[currentSentence.en] = true;
  localStorage.setItem("yesMarks", JSON.stringify(yesMarks));

  // âœ… è¡¨ç¤ºå¯¾è±¡ã‹ã‚‰é™¤å¤–
  remaining = remaining.filter(s => s !== currentSentence.en);
  localStorage.setItem("remaining", JSON.stringify(remaining));

  // âœ… æ¬¡ã®è‹±æ–‡ã‚’è‡ªå‹•è¡¨ç¤º
  if (remaining.length > 0) {
    showRandom();
  } else {
    document.getElementById("sentence-jp").innerText = "ã™ã¹ã¦ã®è‹±æ–‡ã‚’è¡¨ç¤ºã—ã¾ã—ãŸï¼";
    document.getElementById("sentence-en").innerText = "";
    document.getElementById("showBtn").disabled = true;
    document.getElementById("okBtn").disabled = true;
  }
}

function resetData() {
  if (confirm("Reset all data?")) {
    localStorage.removeItem("shownCounts");
    localStorage.removeItem("remaining");
    localStorage.removeItem("yesMarks");
    shownCounts = {};
    yesMarks = {};
    remaining = allSentences.map(s => s.en);
    currentSentence = null;
    document.getElementById("sentence-jp").innerText = "Press 'Show Random' to start";
    document.getElementById("sentence-en").innerText = "";
    document.getElementById("showBtn").disabled = false;
    document.getElementById("statsArea").style.display = "none";
  }
}

function showStats() {
  let tbody = document.getElementById("statsBody");
  tbody.innerHTML = "";

  allSentences.forEach(s => {
    const count = shownCounts[s.en] || 0;
    const yes = yesMarks[s.en] ? "â—" : "â—‹"; // âœ… YESæŠ¼ä¸‹ã—ãŸã‚‚ã®ã‚’ã€Œâ—ã€ã§è¡¨ç¤º
    const row = `
      <tr>
        <td>${s.en}</td>
        <td>${s.jp}</td>
        <td style="text-align:center;">${yes}</td>
        <td style="text-align:center;">${count}</td>
      </tr>`;
    tbody.innerHTML += row;
  });
  document.getElementById("statsArea").style.display = "block";
}

function copyStats() {
  const table = document.querySelector("#statsArea table");
  if (!table) {
    alert("ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
    return;
  }

  let text = "";
  table.querySelectorAll("tr").forEach(tr => {
    // âœ… åŒºåˆ‡ã‚Šæ–‡å­—ã‚’ã€Œ,ã€ã«å¤‰æ›´
    const cols = Array.from(tr.querySelectorAll("th, td")).map(td => td.innerText);
    text += cols.join("@") + "\n";
  });

  navigator.clipboard.writeText(text)
    .then(() => alert("ä¸€è¦§ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"))
    .catch(() => alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"));
}
  
// âœ… ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
document.getElementById("showBtn").onclick = showRandom;
document.getElementById("okBtn").onclick = confirmSentence;
document.getElementById("resetBtn").onclick = resetData;
document.getElementById("statsBtn").onclick = showStats;
document.getElementById("copyBtn").onclick = copyStats;
</script>

</body>
</html>




