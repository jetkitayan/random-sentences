<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Random English Sentences</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  margin-top: 80px;
}
#sentence-jp {
  font-size: 28px;
  margin: 20px 10px;
  color: #333;
}
#sentence-en {
  font-size: 32px;
  margin: 20px 10px;
  color: #0078d7;
}
button {
  padding: 15px 30px;
  font-size: 22px;
  margin: 10px;
  border-radius: 10px;
}
#count {
  font-size: 24px;
  font-weight: bold;
}
</style>
</head>
<body>

<h1>Japanese ↔ English Sentences</h1>
<div id="sentence-jp">Press "Show Random" to start</div>
<div id="sentence-en"></div>
<button id="showBtn">Show Random</button>
<button id="okBtn" disabled>OK</button>
<button id="resetBtn">Reset</button>
<p>Total Shown: <span id="count">0</span></p>

<script>
let allSentences = [];
let shownCounts = JSON.parse(localStorage.getItem("shownCounts")) || {};
let remaining = JSON.parse(localStorage.getItem("remaining")) || [];
let currentSentence = null;

// ✅ JSONファイルを読み込む
fetch("sentences.json")
  .then(response => response.json())
  .then(data => {
    allSentences = data;
    // 初回ロード時にremainingが空なら全件セット
    if (remaining.length === 0) remaining = allSentences.map(s => s.en);
  });

document.getElementById("count").innerText = Object.values(shownCounts).reduce((a,b)=>a+b,0);

function showRandom() {
  if (remaining.length === 0) {
    document.getElementById("sentence-jp").innerText = "すべての英文を表示しました！";
    document.getElementById("sentence-en").innerText = "";
    document.getElementById("showBtn").disabled = true;
    document.getElementById("okBtn").disabled = true;
    return;
  }

  // 残りの中からランダム選択
  const en = remaining[Math.floor(Math.random() * remaining.length)];
  currentSentence = allSentences.find(s => s.en === en);

  // カウントアップ（英文ごとに独立）
  if (!shownCounts[en]) shownCounts[en] = 0;
  shownCounts[en]++;
  localStorage.setItem("shownCounts", JSON.stringify(shownCounts));

  // 合計更新
  const totalShown = Object.values(shownCounts).reduce((a,b)=>a+b,0);
  document.getElementById("count").innerText = totalShown;

  // 日本語＋英語を表示
  document.getElementById("sentence-jp").innerText = currentSentence.jp;
  document.getElementById("sentence-en").innerText = currentSentence.en + 
    `  (${shownCounts[en]}回目)`;

  document.getElementById("okBtn").disabled = false;
}

function confirmSentence() {
  if (!currentSentence) return;
  // OKされた英文を除外
  remaining = remaining.filter(s => s !== currentSentence.en);
  localStorage.setItem("remaining", JSON.stringify(remaining));

  document.getElementById("sentence-jp").innerText = "Press 'Show Random' again";
  document.getElementById("sentence-en").innerText = "";
  document.getElementById("okBtn").disabled = true;

  if (remaining.length === 0) {
    document.getElementById("showBtn").disabled = true;
  }
}

function resetData() {
  if (confirm("Reset all data?")) {
    localStorage.removeItem("shownCounts");
    localStorage.removeItem("remaining");
    shownCounts = {};
    remaining = allSentences.map(s => s.en);
    currentSentence = null;
    document.getElementById("count").innerText = 0;
    document.getElementById("sentence-jp").innerText = "Press 'Show Random' to start";
    document.getElementById("sentence-en").innerText = "";
    document.getElementById("showBtn").disabled = false;
  }
}

document.getElementById("showBtn").onclick = showRandom;
document.getElementById("okBtn").onclick = confirmSentence;
document.getElementById("resetBtn").onclick = resetData;
</script>

</body>
</html>
